J3VzZSBjbGllbnQnOwoKaW1wb3J0IHsgCheckLCBTcGFya2xlcyB9IGZyb20gJ2x1Y2lkZS1yZWFjdCc7CmltcG9ydCB7IG1vdGlvbiB9IGZyb20gJ2ZyYW1lci1tb3Rpb24nOwppbXBvcnQgeyB1c2VTdGF0ZSB9IGZyb20gJ3JlYWN0JzsKaW1wb3J0IHsgbm9ybWFsaXplUGxhbk5hbWUsIGdldFN0cmlwZVBsYW5Db25maWcgfSBmcm9tICdAL2xpYi9zdHJpcGUtY29uZmlnJzsKCmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIFByaWNpbmdTZWN0aW9uKCkgewogIGNvbnN0IFtpc0FubnVhbCwgc2V0SXNBbm51YWxdID0gdXNlU3RhdGUoZmFsc2UpOwoKICBjb25zdCBoYW5kbGVDaGVja291dCA9IGFzeW5jIChwbGFuTmFtZTogc3RyaW5nLCBwcmljZTogbnVtYmVyLCBiaWxsaW5nUGVyaW9kOiAnbW9udGhseScgfCAnYW5udWFsJykgPT4gewogICAgdHJ5IHsKICAgICAgY29uc3QgcGxhblR5cGUgPSBub3JtYWxpemVQbGFuTmFtZShwbGFuTmFtZSk7CiAgICAgIGNvbnN0IHN0cmlwZUNvbmZpZyA9IGdldFN0cmlwZVBsYW5Db25maWcocGxhblR5cGUsIGJpbGxpbmdQZXJpb2QpOwogICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKCcvYXBpL2NoZWNrb3V0JywgewogICAgICAgIG1ldGhvZDogJ1BPU1QnLAogICAgICAgIGhlYWRlcnM6IHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyB9LAogICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsKICAgICAgICAgIHBsYW5OYW1lOiBwbGFuVHlwZSwKICAgICAgICAgIGJpbGxpbmdQZXJpb2QsCiAgICAgICAgICBwcmljZSwKICAgICAgICAgIHByb2R1Y3RJZDogc3RyaXBlQ29uZmlnLnByb2R1Y3RJZCwKICAgICAgICAgIHByaWNlSWQ6IHN0cmlwZUNvbmZpZy5wcmljZUlkLAogICAgICAgIH0pLAogICAgICB9KTsKICAgICAgaWYgKCFyZXNwb25zZS5vaykgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gY3JlYXRlIGNoZWNrb3V0IHNlc3Npb24nKTsKICAgICAgY29uc3QgeyB1cmwgfSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTsKICAgICAgaWYgKHVybCkgd2luZG93LmxvY2F0aW9uLmhyZWYgPSB1cmw7CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICBjb25zb2xlLmVycm9yKCdDaGVja291dCBlcnJvcjonLCBlcnJvcik7CiAgICAgIGFsdXJ0KCdGYWlsZWQgdG8gc3RhcnQgY2hlY2tvdXQuIFBsZWFzZSB0cnkgYWdhaW4uJyk7CiAgICB9CiAgfTsKCiAgY29uc3QgcGxhbnMgPSBbCiAgICB7CiAgICAgIG5hbWU6ICdGdWxsIEFjY2VzcycsCiAgICAgIGRlc2NyaXB0aW9uOiAnRXZlcnl0aGluZyB5b3UgbmVlZCB0byBtYW5hZ2UgeW91ciBvbmxpbmUgcmVwdXRhdGlvbicsCiAgICAgIG1vbnRobHlQcmljZTogMjksCiAgICAgIGFubnVhbFByaWNlOiAyOTksCiAgICAgIGZlYXR1cmVzOiBbCiAgICAgICAgJ1VubGltaXRlZCByZXZpZXcgcmVzcG9uc2VzIHBlciBtb250aCcsCiAgICAgICAgJ0dvb2dsZSBCdXNpbmVzcyBpbnRlZ3JhdGlvbicsCiAgICAgICAgJ0FkdmFuY2VkIEFJIHNlbnRpbWVudCBhbmFseXNpcycsCiAgICAgICAgJ1ByaW9yaXR5IGVtYWlsIHN1cHBvcnQnLAogICAgICAgICc3LWRheSBmcmVlIHRyaWFsJywKICAgICAgXSwKICAgICAgY3RhOiAnU3RhcnQgRnJlZSBUcmlhbCcsCiAgICAgIHBvcHVsYXI6IHRydWUsCiAgICAgIGljb246IFNwYXJrbGVzLAogICAgfSwKICBdOwoKICByZXR1cm4gKAogICAgPHNlY3Rpb24gaWQ9InByaWNpbmciIGNsYXNzTmFtZT0icHktMjAgcHgtNCBzbTpweC02IGxnOnB4LTggcmVsYXRpdmUiPgogICAgICA8ZGl2IGNsYXNzTmFtZT0ibWF4LXctN3hsIG14LWF1dG8gdGV4dC1jZW50ZXIgbWItMTIiPgogICAgICAgIDxoMiBjbGFzc05hbWU9InRleHQtNHhsIGZvbnQtYm9sZCB0ZXh0LXdoaXRlIG1iLTQiPlNpbXBsZSwgVHJhbnNwYXJlbnQgUHJpY2luZzwvaDI+CiAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGdhcC00IG1iLTEyIj4KICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT17IWlzQW5udWFsID8gJ3RleHQtd2hpdGUnIDogJ3RleHQtZ3JheS00MDAnfT5Nb250aGx5PC9zcGFuPgogICAgICAgICAgPGJ1dHRvbiBvbkNsaWNrPXsoKSA9PiBzZXRJc0FubnVhbCghaXNBbm51YWwpfSBjbGFzc05hbWU9InJlbGF0aXZlIHctMTYgaC04IHJvdW5kZWQtZnVsbCBiZy13aGl0ZS8xMCBib3JkZXIgYm9yZGVyLXdoaXRlLzIwIj4KICAgICAgICAgICAgPG1vdGlvbi5kaXYgY2xhc3NOYW1lPSJhYnNvbHV0ZSB0b3AtMSBsZWZ0LTEgdy02IGgtNiByb3VuZGVkLWZ1bGwgYmctZ3JhZGllbnQtdG8tciBmcm9tLVsjMDBjMmZmXSB0by1bIzhiNWNmNl0iIGFuaW1hdGU9e3sgeDogaXNBbm51YWwgPyAzMiA6IDAgfX0gLz4KICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPXtpc0FubnVhbCA/ICd0ZXh0LXdoaXRlJyA6ICd0ZXh0LWdyYXktNDAwJ30+QW5udWFsPC9zcGFuPgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3NOYW1lPSJtYXgtdy14bCBteC1hdXRvIGJnLXdoaXRlLzUgYm9yZGVyIGJvcmRlci1bIzAwYzJmZl0gcm91bmRlZC0yemwgcC04Ij4KICAgICAgICAgIDxoMyBjbGFzc05hbWU9InRleHQtMnhsIGZvbnQtYm9sZCB0ZXh0LXdoaXRlIG1iLTQiPkZ1bGwgQWNjZXNzPC9oMz4KICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LTV4bCBmb250LWJvbGQgdGV4dC13aGl0ZSBtYi02Ij4ke2lzQW5udWFsID8gMjk5IDogMjl9IDxzcGFuIGNsYXNzTmFtZT0idGV4dC1sZyB0ZXh0LWdyYXktNDAwIj4ve2lzQW5udWFsID8gJ3llYXInIDogJ21vbnRoJ308L3NwYW4+PC9kaXY+CiAgICAgICAgICA8YnV0dG9uIG9uQ2xpY2s9eygpID0+IGhhbmRsZUNoZWNrb3V0KCdGdWxsIEFjY2VzcycsIGlzQW5udWFsID8gMjk5IDogMjksIGlzQW5udWFsID8gJ2FubnVhbCcgOiAnbW9udGhseScpfSBjbGFzc05hbWU9InctZnVsbCBweS00IHJvdW5kZWQteGwgYmctZ3JhZGllbnQtdG8tciBmcm9tLVsjMDBjMmZmXSB0by1bIzhiNWNmNl0gdGV4dC13aGl0ZSBmb250LWJvbGQgbWItOCI+U3RhcnQgRnJlZSBUcmlhbDwvYnV0dG9uPgogICAgICAgICAgPHVsIGNsYXNzTmFtZT0idGV4dC1sZWZ0IHNwYWNlLXktNCI+CiAgICAgICAgICAgIHtwbGFuc1swXS5mZWF0dXJlcy5tYXAoKGYsIGkpID0+ICgKICAgICAgICAgICAgICA8bGkga2V5PXtpfSBjbGFzc05hbWU9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0zIHRleHQtZ3JheS0zMDAiPjxDaGVjayBjbGFzc05hbWU9InRleHQtWyMwMGMyZmZdIiAvPiB7Zn08L2xpPgogICAgICAgICAgICApKX0KICAgICAgICAgIDwvdWw+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PgogICAgPC9zZWN0aW9uPgogICk7Cn0K